### 4.1 配列のメリット
いくつかの関係あるデータをグループにして、まとめて一つの変数に入れる仕組みがある. ある一定のルールに従ってデータを格納する形式を「データ構造」と呼ぶ.

- 使用例：
  - テストの科目の点数
  - 携帯電話のアドレス帳
- データ構造の例：
  - 配列、マップ、スタック、..
- Java の配列は, 同一種類の複数データを, 並び順で格納するデータ構造となっている
  - 図4-1
  - ひとつひとつを要素（element）と呼ぶ
- 配列の各要素には番号（先頭から何番目か）がついており添字（index）と呼ぶ
  - Java では index が 0 から始まる
  - 最後の添字は length - 1 となる

### 4.2 配列の書き方

- 配列変数の宣言
  - 例：int[] scores;
- 配列の作成と変数への代入
  - 例：scores = new int[5];
  - メモリを確保して object を作成するときには大体 new を使う
- 長さは length で取得する
  - 引数で int[] 型が渡されたときに長さがわからないため
  - メソッドではなくフィールド（カッコ不要）
- 配列は作成した時点で, 各要素が勝手にゼロ値で初期化される
  - int のゼロ値は 0 なのですべての要素が 0 で初期化される
  - ただし object のゼロ値は null なので, object の配列もすべての要素が null で初期化される
- 省略記法
  - 例：int[] numbers = {1,2,3}

### 4.3 配列と例外
ArrayIndexOutOfBoundsException

- 作成した長さを超えて index へアクセスしようとするとエラーとなる

### 4.4 配列のデータをまとめて..

- 指定する添字を変数にすることで配列のすべての要素（あるいは条件を満たす一部の要素）へアクセスできる
- for loop によるイディオム
  - 全要素へのアクセス、集計、添字に対応した利用
  - 後半に出てくるはずの Streaming API を使うことでより簡潔に書ける
- 全要素アクセスについては「:」を使った拡張構文を使う
  - 他の言語にもだいたいある
  - 添字位置を覚えておく必要がある場合は使えない
  - 値が１である要素が格納されている位置（index）を知りたいときなど

所感：

- パターン３はバッドノウハウな気がする
  - 添字のもつ意味を人間が覚えておく必要があるため
  - 第三者によるレビューも困難になる
  - enum などの別の仕組みを使って解決するのが一般的か

### 4.5 配列の舞台裏

- 配列型の変数はポインタ変数となっている.
  - ポインタ変数はメモリ内のアドレス位置を数値として保持している
- 4.5.3
  - 代入するとポインタの指し示すアドレス（配列の実体）が変わる
- 4.5.4 配列を複数の変数で参照する
  - これは object に対する変数の場合も同じで, 同じ object に対して複数の変数（別の名前付け）を貼り付けることができる
- コピーしたいときは別の配列を作り直して各要素をクローンする必要がある

### 4.6 配列の後片付け

- 中括弧でスコープを切る、あるいは参照を切る（null を代入する）などの操作で, 作成した object や変数領域をガベージコレクションの対象とすることができる
  - 対象となったからと言ってメモリが直ちに解放されるわけではなく、メモリが足りなくなったりするとガベージコレクションが走るようになっている
  - 適当なタイミングでガベージコレクションが走ると、ガベージコレクションの対象となったメモリが解放される

```java
{
    String aaa = "aaa";
}
// この時点で aaa はガベージコレクションの対象となる
{
    String bbb = "bbb";
}
```

- null が入っている変数に対して, 内部要素への参照をする, メソッドを呼ぶなどの操作はできない
  - 操作すると NullPointerException が起こる
  - try/catch で handling しないとプログラムが中断する

所感：

- （少なくとも昔は）ガベージコレクションの走るタイミングが適当すぎて瞬間的に負荷が上がりリソースが不足することがあった
  - 最近はもう少し賢くなっているはず
  - ガベージコレクションを持つ他の言語でも課題に上がる
- GC のメソッドを呼ぶことで積極的にガベージコレクションを起動することもできる
  - C のように自分で変数を指定して解放するような操作はない

- NullPointerException などの例外を防ぐため変数を初期化する癖をつけておく
  - 性能向上のために初期化をあとから行う場合もあるが
  - 途中でエラー落ちしてしまうと本末転倒
- Nullable / NonNull
  - この厄介な例外を予防するために Nullable.. という構文が追加されていたはず
  - https://qiita.com/craftone/items/883cb1bcc5ed404dc669

### 4.7 多次元の配列

- 多次元配列と呼んでいるが、要は配列の配列である
  - １段目の配列の各要素が配列となっており、さらにその配列の要素にも配列を格納することができる
- 4-19
  - length を使い scores の 0 番目の要素が長さ 3 の配列となっていることを確認している
  - 確認していないが scores の他の要素も長さ 3 の配列となっている

所感：

- あまり使わない気がする＞配列を使う頻度は非常に高いから
  - 可読性が悪すぎるため
  - 多次元配列は python のコードでよく見る. がやはり可読性が課題となっている

### 4.8 第４章のまとめ

所感：

- 配列のビルトイン機能には add や remove といった操作がない
  - 配列が object ではなく primitive であるため？
  - 多くのスクリプト言語には備わっている
- 代わりに上記の機能を備えた List を使うことが多い
  - List と配列の相互変換が面倒なので, 最初から List を使うことが多くなり, 配列のお世話になることは少なくなる

### 演習回答

- [./src/test/java/sukkiri_3/ch4](./src/test/java/sukkiri_3/ch4)
- [./src/main/java/sukkiri_3/ch4](./src/main/java/sukkiri_3/ch4)
